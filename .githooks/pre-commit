#!/bin/bash
#
# Pre-commit hook for Sir Tips-A-Lot
# Runs unit tests before allowing commits
#
# Setup: git config core.hooksPath .githooks
#

set -e

echo "üß™ Running unit tests before commit..."

# Navigate to project root
cd "$(git rev-parse --show-toplevel)"

# Check if xcodebuild is available
if ! command -v xcodebuild &> /dev/null; then
    echo "‚ö†Ô∏è  xcodebuild not found. Skipping tests."
    echo "   Install Xcode Command Line Tools: xcode-select --install"
    exit 0
fi

# Run tests using generic simulator destination for portability
xcodebuild test \
    -project "TipCal/Tip Calculator/Tip Calculator.xcodeproj" \
    -scheme "Tip Calculator" \
    -destination 'generic/platform=iOS Simulator' \
    -quiet \
    2>&1

TEST_RESULT=$?

if [ $TEST_RESULT -eq 0 ]; then
    echo "‚úÖ All tests passed!"
    exit 0
else
    echo ""
    echo "‚ùå Tests failed! Commit aborted."
    echo ""
    echo "Fix the failing tests before committing."
    echo "To bypass this hook (not recommended): git commit --no-verify"
    exit 1
fi

